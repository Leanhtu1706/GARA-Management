@model GaraManagement.Models.Repair
@{
    ViewData["Title"] = "Báo giá";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container-fluid">

    <div class="c-subheader justify-content-between px-3">
        <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">Home</li>
            <li class="breadcrumb-item"><a href="#">Admin</a></li>
            <li class="breadcrumb-item">QL Sửa chữa</li>
            <li class="breadcrumb-item">Nhập xuất xưởng</li>
            <li class="breadcrumb-item">Sửa chữa</li>
            <li class="breadcrumb-item active">Báo giá</li>
        </ol>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="table-area">
                <div class="row">
                    <div class="col-md-2">
                        <a class="btn btn-sm btn-default" asp-action="Details" asp-route-id="@Model.Id">Trở về</a>
                    </div>
                    <div class="col-md-7">
                        <h4 style="text-align:center">Báo giá sửa chữa</h4>
                    </div>
                </div>
                <div class="tableFixHead">
                    <table id="dtTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>
                                    Tên công việc
                                </th>
                                <th>
                                    Chi phí
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int? totalCost = 0;
                                if (Model.DetailRepairs.Any())
                                {

                                    foreach (var item in Model.DetailRepairs)
                                    {
                                        totalCost += item.IdWorkNavigation.Cost;
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IdWorkNavigation.WorkName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IdWorkNavigation.Cost)
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                            <tr>
                                <td colspan="2"><h4>Tổng tiền công: &ensp; @totalCost</h4></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="tableFixHead">
                    <table id="dtTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>
                                    Tên vật tư
                                </th>
                                <th>
                                    Số lượng
                                </th>
                                <th>
                                    Giá
                                </th>
                                <th>
                                    Tổng
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int? totalMaterial = 0;
                                if (Model.GoodsDeliveryNotes.FirstOrDefault() != null)
                                {
                                    foreach (var item in Model.GoodsDeliveryNotes.FirstOrDefault().DetailGoodsDeliveryNotes)
                                    {
                                        if (item != null)
                                        {
                                            var totalPrice = item.Amount * item.IdMaterialNavigation.Price;
                                            totalMaterial = totalMaterial + totalPrice;
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IdMaterialNavigation.Name)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Amount)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IdMaterialNavigation.Price)
                                            </td>
                                            <td>
                                                @totalPrice
                                            </td>
                                        </tr>
                                        }

                                    }
                                }
                                <tr>
                                    <td colspan="4"><h4>Tổng tiền vật tư: &ensp;@totalMaterial</h4></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    @{
        int? total = totalCost + totalMaterial;
        int? paid = Model.Pays.Select(p => p.Paid).FirstOrDefault();
        int? owe = total - paid;
    }
<div class="row">
    <div class="col-md-12">
        <div class="table-area row">
            <div class="col-md-4">
                <h4 style="color: #ff870c">Tổng chi phí phải thanh toán: &ensp; @total</h4>
            </div>
            <div class="col-md-3">
                <h4 style="color: #1ac155">Đã thanh toán: &ensp; @paid</h4>
            </div>
            <div class="col-md-3">
                <h4 style="color: #c50c0c">Còn nợ: &ensp; @owe</h4>
            </div>
            <div class="col-md-2">
                <a class="btn btn-sm btn-warning paybtn" >Thanh toán</a>
                <a class="btn btn-sm btn-warning owebtn" >Trả nợ</a>
            </div>
        </div>
    </div>

</div>
</div>

<style>
    .table-area {
        margin: 5px 0;
    }

    .tableFixHead {
        overflow-y: auto;
        height: 250px;
    }

    .tableFixHead thead th {
        position: sticky;
        top: 0;
    }


</style>

<script src="~/assets/js/core/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        if ("@ViewBag.exists") {
            console.log("Exists");
            $('.paybtn').css("display", "none");
            $('.owebtn').css("display", "block");
        }
        else {
            console.log("No Exists");
            $('.paybtn').css("display", "block");
            $('.owebtn').css("display", "none");
        }
    })
</script>
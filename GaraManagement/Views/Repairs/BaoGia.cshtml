@model GaraManagement.Models.Repair
@{
    ViewData["Title"] = "Báo giá";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container-fluid">

    <div class="c-subheader justify-content-between px-3">
        <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">Home</li>
            <li class="breadcrumb-item"><a href="#">Admin</a></li>
            <li class="breadcrumb-item">QL Sửa chữa</li>
            <li class="breadcrumb-item">Nhập xuất xưởng</li>
            <li class="breadcrumb-item">Sửa chữa</li>
            <li class="breadcrumb-item active">Báo giá</li>
        </ol>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="table-area">
                <h4 style="text-align:center">Báo giá sửa chữa</h4>
                <div class="tableFixHead">
                    <table id="dtTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>
                                    Tên công việc
                                </th>
                                <th>
                                    Chi phí
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int? totalCost = 0;
                                if (Model.DetailRepairs != null)
                                {

                                    foreach (var item in Model.DetailRepairs)
                                    {
                                        totalCost += item.IdWorkNavigation.Cost;
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IdWorkNavigation.WorkName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IdWorkNavigation.Cost)
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                            <tr>
                                <td colspan="2"><h4>Tổng tiền công: &ensp; @totalCost</h4></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="tableFixHead">
                    <table id="dtTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>
                                    Tên vật tư
                                </th>
                                <th>
                                    Số lượng
                                </th>
                                <th>
                                    Giá
                                </th>
                                <th>
                                    Tổng
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int? totalMaterial = 0;
                                foreach (var item in Model.GoodsDeliveryNotes.FirstOrDefault().DetailGoodsDeliveryNotes)
                                {
                                    if (item != null)
                                    {
                                        var totalPrice = item.Amount * item.IdMaterialNavigation.Price;
                                        totalMaterial = totalMaterial + totalPrice;
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IdMaterialNavigation.Name)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Amount)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IdMaterialNavigation.Price)
                                            </td>
                                            <td>
                                                @totalPrice
                                            </td>
                                        </tr>
 }

                                }
                                <tr>
                                    <td colspan="4"><h4>Tổng tiền vật tư: &ensp;@totalMaterial</h4></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    @{
        int? total = totalCost + totalMaterial;
    }
    <div class="row">
        <div class="col-md-12">
            <div class="table-area">
                <h4 style="color:#c50c0c">Tổng chi phí phải thanh toán: &ensp; @total</h4>
            </div>
        </div>
    </div>
</div>

<style>
    .table-area {
        margin: 5px 0;
    }

    .tableFixHead {
        overflow-y: auto;
        height: 250px;
    }

    .tableFixHead thead th {
        position: sticky;
        top: 0;
    }


</style>
